[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Item",
  "enabled": 1,
  "modified": "2025-02-17 23:29:46.140872",
  "module": "MBW Integration DMS",
  "name": "Xác định đvt chẵn lẻ của Item",
  "script": "frappe.ui.form.on('Item', {\n    validate: function(frm) {\n        ensure_unique_selection(frm, 'uoms', 'unit_odd');\n        ensure_unique_selection(frm, 'uoms', 'unit_even');\n    }\n});\n\nfunction ensure_unique_selection(frm, child_table, fieldname) {\n    let selected_rows = frm.doc[child_table].filter(row => row[fieldname]);\n\n    if (selected_rows.length > 1) {\n        selected_rows.forEach((row, index) => {\n            if (index > 0) {\n                row[fieldname] = 0;\n            }\n        });\n        frappe.msgprint(__('Chỉ được chọn 1 sản phẩm là đơn vị chẵn và 1 sản phẩm là đơn vị lẻ '));\n        frm.refresh_field(child_table);\n    }\n}\n\nfrappe.ui.form.on('UOM Conversion Detail', {\n    unit_odd: function(frm, cdt, cdn) {\n        toggle_other_rows(frm, cdt, cdn, 'unit_odd', 'unit_even');\n    },\n    unit_even: function(frm, cdt, cdn) {\n        toggle_other_rows(frm, cdt, cdn, 'unit_even', 'unit_odd');\n    }\n});\n\nfunction toggle_other_rows(frm, cdt, cdn, selected_field, other_field) {\n    let child = locals[cdt][cdn];\n\n    if (child[selected_field]) {\n        frm.doc.uoms.forEach(row => {\n            if (row.name !== child.name) {\n                row[selected_field] = 0;\n            }\n            // Khi chọn một dòng là chẵn/lẻ, tự động bỏ tích dòng đó ở trường còn lại\n            row[other_field] = (row.name === child.name) ? 0 : row[other_field];\n        });\n        frm.refresh_field('uoms');\n    }\n}\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Order",
  "enabled": 1,
  "modified": "2025-02-25 14:56:55.848787",
  "module": "MBW Integration DMS",
  "name": "Disable DMS Fields in SO",
  "script": "frappe.ui.form.on('Sales Order', {\n    refresh: function(frm) {\n        let fields_item_to_disable = [\"item_code\", \"qty\", \"rate\", \"discount_amount\", \"additional_notes\", \"is_free_item\", \"uom\"];\n        let fields_promotion_to_disable = [\"promotion_id\", \"promotion_code\", \"promotions_name\", \"promotion_item_id\", \"promotion_item_code\", \"promotional_item_name\", \"promotional_quantity\", \"promotional_amount\"];\n        if (frm.doc.is_sale_dms == 1 && frm.doc.docstatus == 0) {\n            // Vô hiệu hóa các trường chính\n            let fields_to_disable = ['customer', 'dms_so_code', 'delivery_date', 'dms_so_id', 'set_warehouse', 'discount_amount', 'apply_discount_on'];\n            fields_to_disable.forEach(field => {\n                frm.set_df_property(field, 'read_only', 1);\n            });\n\n            // Khóa bảng con - không cho thêm/sửa/xóa\n            frm.fields_dict[\"items\"].grid.df.cannot_add_rows = true;\n            frm.fields_dict[\"items\"].grid.df.cannot_delete_rows = true;\n            frm.refresh_field(\"items\");\n\n            frm.fields_dict[\"promotion_result\"].grid.df.cannot_add_rows = true;\n            frm.fields_dict[\"promotion_result\"].grid.df.cannot_delete_rows = true;\n            frm.refresh_field(\"promotion_result\");\n            \n            // Vô hiệu hóa từng field trong bảng con Sales Order Item\n            fields_item_to_disable.forEach(field => {\n                frm.fields_dict.items.grid.update_docfield_property(field, \"read_only\", 1);\n            });\n            frm.refresh_field(\"items\");\n            \n            // Vô hiệu hóa từng field trong bảng con DMS Promotions Result\n            fields_promotion_to_disable.forEach(field => {\n                frappe.fields_dict.promotion_result.grid.update_docfield_property(field, \"read_only\", 1);\n            });\n        }\n        else {\n            fields_item_to_disable.forEach(field => {\n                frm.fields_dict.items.grid.update_docfield_property(field, \"read_only\", 0);\n            });\n            frm.refresh_field(\"items\");\n            \n        }\n    }\n});\n",
  "view": "Form"
 }
]